(()=>{"use strict";const e=window.wp.element,t=window.wp.data,o=window.wp.plugins,l=window.wp.editPost,a=window.wp.compose,n=window.wp.i18n,i=window.wp.components,r=window.wp.blockEditor,d=window.wp.editor,s=window.lodash;var c;const u=["video"],m=[{value:"auto",label:(0,n.__)("Auto")},{value:"metadata",label:(0,n.__)("Metadata")},{value:"none",label:(0,n.__)("None")}],p={useLocal:!1,id:0,url:"",caption:"",useFeaturedImageAsPoster:!1,settings:{autoplay:!1,loop:!1,muted:!1,controls:!0,playsInline:!1,preload:"auto",poster:""}},g=null!==(c=sfvEditorData.isPremium)&&void 0!==c&&c,_=(0,t.withSelect)((e=>{const{getMedia:t}=e("core"),{getEditedPostAttribute:o}=e("core/editor"),l=o("meta");try{const e=JSON.parse(l.sfv_video);return(0,s.isObject)(e)?{featuredVideo:e,media:t(e.id),useLocalVideo:e.useLocal}:{featuredVideo:p,media:null,useLocalVideo:p.useLocal}}catch(e){return{featuredVideo:p,media:null,useLocalVideo:p.useLocal}}})),v=(0,t.withDispatch)(((e,t,o)=>{let{noticeOperations:l}=t,{select:a}=o;const{editPost:n}=e("core/editor"),{getEditedPostAttribute:i}=a("core/editor"),r=i("meta");let d={};try{d=JSON.parse(r.sfv_video)}catch(e){d=p}return{onUpdateMeta:(e,t)=>{d=(0,s.set)(d,e,t),n({meta:{sfv_video:JSON.stringify(d)}})},onDropVideo(e){a("core/block-editor").getSettings().mediaUpload({allowedTypes:u,filesList:e,onFileChange(e){let[t]=e;d.id=t.id,n({meta:{sfv_video:JSON.stringify(d)}})},onError(e){l.removeAllNotices(),l.createErrorNotice(e)}})},onRemoveVideo(){n({meta:{sfv_video:JSON.stringify(p)}})}}}));(0,o.registerPlugin)("plugin-simply-featured-video-panel",{render:(0,a.compose)(_,v)((t=>{let{featuredVideo:o,onUpdateMeta:a,onDropVideo:c,onRemoveVideo:p,media:_,noticeUI:v,useLocalVideo:E}=t;return(0,e.createElement)(d.PostTypeSupportCheck,{supportKeys:"custom-fields"},(0,e.createElement)(l.PluginDocumentSettingPanel,{title:(0,n.__)("Featured video")},v,(0,e.createElement)("div",{className:"editor-simply-featured-video"},(0,e.createElement)(i.ToggleControl,{label:(0,n.__)("Use media library"),help:E?(0,n.__)("Set video source from media library."):(0,e.createElement)(e.Fragment,null,`${(0,n.__)("Set Video source from url.")} `,(0,e.createElement)(i.ExternalLink,{href:"https://wordpress.org/support/article/embeds/#okay-so-what-sites-can-i-embed-from"},(0,n.__)("See supported video provider."))),onChange:e=>{a("useLocal",e)},checked:o.useLocal}),E?(0,e.createElement)(r.MediaUploadCheck,{fallback:(0,e.createElement)("p",null,(0,n.__)("To edit the featured video, you need permission to upload media."))},(0,e.createElement)(r.MediaUpload,{title:(0,n.__)("Featured video"),onSelect:e=>a("id",e.id),allowedTypes:u,value:o,render:t=>{let{open:l}=t;return(0,e.createElement)("div",{className:"editor-simply-featured-video__container"},0===o.id&&(0,e.createElement)("div",{className:"editor-simply-featured-video__dropzone"},(0,e.createElement)(i.Button,{onClick:l,className:"editor-simply-featured-video__toggle"},(0,n.__)("Set featured video")),(0,e.createElement)(i.DropZone,{onFilesDrop:c})),o.id>0&&(0,s.isNil)(_)&&(0,e.createElement)("div",{className:"editor-simply-featured-video__dropzone"},(0,e.createElement)(i.Spinner,null),(0,e.createElement)(i.DropZone,{onFilesDrop:c})),o.id>0&&!(0,s.isNil)(_)&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{className:"editor-simply-featured-video__dropzone"},(0,e.createElement)(i.ResponsiveWrapper,{naturalWidth:_.media_details.width,naturalHeight:_.media_details.height,isInline:!0},(0,e.createElement)("video",{controls:!0},(0,e.createElement)("source",{src:_.source_url,type:_.mime_type}))),(0,e.createElement)(i.DropZone,{onFilesDrop:c})),(0,e.createElement)(i.Button,{onClick:l,isSecondary:!0},(0,n.__)("Replace video")),(0,e.createElement)(i.Button,{isDestructive:!0,onClick:p},(0,n.__)("Remove video")),g?(0,e.createElement)(i.ToggleControl,{label:(0,n.__)("Use featured image as poster"),onChange:e=>{a("useFeaturedImageAsPoster",e)},checked:o.useFeaturedImageAsPoster}):(0,e.createElement)(e.Fragment,null,(0,e.createElement)("p",null,(0,n.__)("Poster setting is only available in Pro."))),(0,e.createElement)(i.ToggleControl,{label:(0,n.__)("Autoplay"),onChange:e=>{a("settings.autoplay",e)},checked:o.settings.autoplay}),(0,e.createElement)(i.ToggleControl,{label:(0,n.__)("Loop"),onChange:e=>{a("settings.loop",e)},checked:o.settings.loop}),(0,e.createElement)(i.ToggleControl,{label:(0,n.__)("Muted"),onChange:e=>{a("settings.muted",e)},checked:o.settings.muted}),(0,e.createElement)(i.ToggleControl,{label:(0,n.__)("Playback controls"),onChange:e=>{a("settings.controls",e)},checked:o.settings.controls}),(0,e.createElement)(i.ToggleControl,{label:(0,n.__)("Play inline"),onChange:e=>{a("settings.playsInline",e)},checked:o.settings.playsInline}),(0,e.createElement)(i.SelectControl,{label:(0,n.__)("Preload"),value:o.settings.preload,onChange:e=>{a("settings.preload",e)},options:m,hideCancelButton:!0})))}})):(0,e.createElement)("div",null,(0,e.createElement)(i.TextControl,{label:"Video URL",value:o.url,onChange:e=>a("url",e)}),(0,e.createElement)(i.TextareaControl,{label:"Caption",value:o.caption,onChange:e=>a("caption",e)})))))})),icon:null})})();